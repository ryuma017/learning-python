# 文字列 ー 整形と分割/結合/検索など


## 3.1 基本的な文字列操作

文字列は変更不可(イミュータブル)だから、特定の要素やスライスに対する代入はできない

```
>>> website = "http://www.python.org"
>>> website[-3:]   # インデックス-3からの要素を返す
'org'
>>> website[-3:] = "com"   # 「インデックス-3以降に代入」はできない
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
TypeError: 'str' object does not support item assignment
```


## 3.2 文字列の整形[概要]

### 3.2.1 formatメソッド

最もよく利用さているのが、文字列のformatメソッド

- 最も単純な使い方 無名のフィールドかインデックスを使う

```
>>> "{}、{}、そして{}".format("1番", "2番", "3番")
'1番、2番、そして3番'   # 無名のフィールドと引数が順に対応
>>> "{3} {0} {2} {1} {3} {0}".format("be", "not", "or", "to")
'to be or not to be'   # フィールドのインデックスに引数が順に対応
```

- 名前で指定する使い方 名前付きフィールド

```
>>> from math import pi   # 円周率πの値をインポート
>>> "{name}の値はおよそ{value:.2f}です。".format(value=pi, name="π")
'πの値はおよそ3.14です。'
```

フォーマット指定子`.2f`は「数値を小数点以下2桁までの表記にしてほしい」という意味

- 置換フィールドの名前と変数名が同じ場合の省略形

先頭に`f`をつけて表す

```
>>> from math import e   # オイラー定数をインポート
>>> f"オイラー定数はおよそ{e}です。"
'オイラー定数はおよそ2.718281828459045です。'
```

### 3.2.2 文字列フォーマット演算子

当初は、文字列フォーマット演算子の`%`を使っていた

```
>>> format = "こんにちは、%sさん。%sですか？"   # フォーマット文字列
>>> values = ("花子", "お元気")   # 値のタプル
>>> format % values   # フォーマット文字列にタプルの値を組み込む
'こんにちは、花子さん。お元気ですか？'
>>> values = ("太郎", "暑い")
>>> format % values
'こんにちは、太郎さん。暑いですか？'
```

`%s`: 変換指定子。値が挿入される場所を指定する

### 3.2.3 テンプレート文字列

UNIXに似た構文を使う

```
>>> from string import Template
>>> tmpl = Template("こんにちは、$whoさん。$whatですか？")
>>> tmpl.substitute(who="太郎", what="暑い")   # tmplの$whoと$whatの部分が置換される
'こんにちは、太郎さん。暑いですか？'
>>> tmpl.substitute(who="花子", what="ほこりっぽい")
'こんにちは、花子さん。ほこりっぽいですか？'
```


## 3.3 文字列の整形の詳細

＜formatの使い方まとめ＞
- formatメソッドの引数に、整形したい値を渡す
- どのようにsを整形するかは、テンプレート用言語で記述する
- 値を置くフィールドは、{...}で囲まれた置換フィールドで指定する
- 文字列中に波括弧の{や}を含めたいときは、波括弧を2つ連続させる。つまり{{ あるいは }}と書く

### 3.3.1 置換フィールド名

- フォーマット文字列に無名フィールドを使い、formatには無名引数を渡す

```
>>> "{} {} {} {}".format(1, 2, 4, 3)   # {}が無名フィールド
'1 2 4 3'
>>> "{foo} {} {bar} {}".format(1, 2, bar=4, foo=3)   # {foo}と{bar}が名前付きフィールド
'3 1 4 2'
```

- 数値を使って順番を指定

```
>>> "{foo} {1} {bar} {0}".format(1, 2, bar=4, foo=3)   # {}と{}が順番を指定したフィールド
'3 2 4 1'
```

- フィールド番号の手動指定と自動指定を混在させるのは禁止されている

```
>>> "{} {2} {} {4}".format(1, 2, bar=4, foo=3)
Traceback (most recent call last):
File "<stdin>", line 1, in <module>
ValueError: cannot switch from automatic field numbering to manual field specification
```

### 3.3.2 基本的な変換

フィールドに入れるものを指定した後は、それをどのようにフォーマットするか指示する

- 最初に変換フラグ`!`を指定する

```
>>> print("{pi!s} {pi!r} {pi!a}".format(pi="π"))
π 'π' '\u03c0'   # 自然な文字列表現、python表現、Unicode表現で出力
```

- 変換する値の型

```
>>> "The number is {num}".format(num=42)
'The number is 42'
>>> "The number is {num:f}".format(num=42)   # :fで少数表記
'The number is 42.000000'
>>> "The number is {num:b}".format(num=42)   # :bで2進数表記
'The number is 101010'
```

### 3.3.3 表示幅、精度、桁区切り文字

必要に応じて幅や制度を細かく指定できる

- 表示幅は整数で指定

数値と文字列では左右揃えは異なる

```
>>> "{num:10}".format(num=3)   # :10で表示幅10を指定
'         3'
>>> "{name:10}".format(name="Bob")
'Bob       '
>>> "{name:10}".format(name="太郎")
'太郎        '
```

- 小数部の桁などの精度は整数の前に小数点(`.`)を付けて指定

```
>>> "{pi:.2f}はパイを食べる日です。".format(pi=math.pi)   # .2fで小数部の桁を指定
'3.14はパイを食べる日です。'
>>> "{pi:10.2f}".format(pi=math.pi)   # 表示幅10、小数部の桁2
'      3.14'
```

- 整数の3桁ごとの桁区切りは`,`を使って指定

```
>>> "1グーゴル(googol)の値は{:,}に等しい。".format(10**100)   # 10の100乗
'1グーゴル(googol)の値は10,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000
,000,000,000,000,000,000,000,000,000,000,000,000,000,000に等しい。'
```

### 3.3.4 符号、左右揃え、ゼロパディング

表示幅と精度を表す数値の前に、「フラグ」を付ける。`0` `+` `-` あるいはスペー(空白文字)のいずれか

- 数値の前を0で埋める

```
>>> pi = math.pi
>>> "{:010.2f}".format(pi)   # 数値の前は0で埋め、表示幅10、小数部2桁
'0000003.14'
```

- 左揃え、右揃え、中央揃え(センタリング)。`<` `>` `^` で指定

```
>>> print("{0:<10.2f}\n{0:^10.2f}\n{0:>10.2f}".format(pi))
3.14         # 左揃え<の場合
    3.14      # 中央揃え^の場合
        3.14   # 右揃え>の場合
```

- 左右揃え指定子に充填文字(fill character)を加えることで、その文字がスペースの代わりに使われる

```
>>> "{:$^15}".format(" HELLO ")   # 充填文字は$
'$$$$ HELLO $$$$'
```

- `=`を使うことで、符号と数値の間を指定の充填文字で埋めることができる

```
>>> print("{0:10.2f}\n{1:10.2f}".format(pi, -pi))
    3.14
    -3.14
>>> print("{0:10.2f}\n{1:=10.2f}".format(pi, -pi))   # 書式に=を指定
    3.14
-     3.14
>>> print("{0:10.2f}\n{1:$=10.2f}".format(pi, -pi))
    3.14
-$$$$$3.14
```

- 正数にも符号を付けたければ、`-`の代わりに`+`を使う

```
>>> print("{0:-.2}\n{1:-.2}".format(pi, -pi))   # 書式に-を指定
3.1
-3.1
>>> print("{0:+.2}\n{1:+.2}".format(pi, -pi))   # 書式に+を指定
+3.1
-3.1
>>> print("{0: .2}\n{1: .2}".format(pi, -pi))   # 書式に空白を指定
    3.1
-3.1
```

- `#`のあとに、それぞれ`b`、`o`、`x`を指定することで、それぞれの数値の種類を表す記号が追加される。

2進数:`ob` 8進数:`0o` 16進数:`0x`

```
>>> "{:b}".format(42)
'101010'
>>> "{:#b}".format(42)
'0b101010'
>>> "{:o}".format(42)
'52'
>>> "{:#o}".format(42)
'0o52'
>>> "{:x}".format(42)
'2a'
>>> "{:#x}".format(42)
'0x2a'
```
